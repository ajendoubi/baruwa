{% extends "base.html" %}
{% block headers %}
<script type="text/javascript" src="/static/js/jquery-1.4.min.js"></script>
<script type="text/javascript" src="/static/js/local.js"></script>
{% endblock headers %}
{% block title %}Baruwa :: Showing message - {{ message_details.id }} {% endblock %}
{% block heading %}Showing message - {{ message_details.id }} {% endblock %}
{% block messaged %} value="{{ message_details.id }}" {%endblock %}
{% block submenu %}
{% if message_details.quarantined %}
<ul>
  <li><a href="/messages/preview/{{message_details.id}}/">Preview message</a></li>
  <li><a href="#q">Release message</a></li>
</ul>
{% else %}
&nbsp;
{% endif %}
{% endblock submenu %}
{% block content %}
<table class="maillog">
{% if message_details %}
{% load messages_extras %}
{% load relayed_via %}
  <tbody>
		<tr>
		<td class="mailitem">Message ID:</td>
		<td class="maildetail">{{ message_details.id }}</td>
		</tr>
		<tr>
		<td class="mailitem">From:</td>
		<td class="maildetail">{{ message_details.from_address|tds_trunc:80 }}
    <span class="listings">
    [{% if not message_details.spamwhitelisted %}<a href="">Add to whitelist</a>{%else%}Add to whitelist{%endif%}]
    &nbsp;
    [{% if not message_details.spamblacklisted %}<a href="">Add to blacklist</a>{%else%}Add to blacklist{%endif%}]
    </span>
    </td>
		</tr>
		<tr>
		<td class="mailitem">To:</td>
		<td class="maildetail">{{ message_details.to_address|tds_nl_commas|linebreaksbr }}</td>
		</tr>
		<tr>
		<td class="mailitem">Subject</td>
		<td class="maildetail">{{ message_details.subject }}</td>
		</tr>
		<tr>
		<td class="mailitem">Received on:</td>
		<td class="maildetail">{{ message_details.timestamp }}</td>
		</tr>
		<tr>
		<td class="mailitem">Received by:</td>
		<td class="maildetail">{{ message_details.hostname }}</td>
		</tr>
		<tr>
		<td class="mailitem">Received from:</td>
		<td class="maildetail">{{ message_details.clientip }}</td>
		</tr>
		<tr>
		<td class="mailitem">Received via:</td>
		<td>{% relayed_via message_details.headers %}</td>
		</tr>
		<tr>
		<td class="mailitem">Message Headers:</td>
		<td class="maildetail">{{ message_details.headers|tds_wrap_headers|linebreaksbr }}</td>
		</tr>
		<tr>
		<td class="mailitem">Size:</td>
		<td class="maildetail">{{ message_details.size|filesizeformat }}</td>
		</tr>
		<tr>
		<td class="mailitem">Virus:</td>
		<td class="maildetail">{% if message_details.virusinfected %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">Blocked File:</td>
		<td class="maildetail">{% if message_details.nameinfected %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">Other infection:</td>
		<td class="maildetail">{% if message_details.otherinfected %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td colspan="2" class="divider">Spamassassin information</td>
		</tr>
		<tr>
		<td class="mailitem">Spam:</td>
		<td class="maildetail">{% if message_details.isspam %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">High Scoring Spam:</td>
		<td class="maildetail">{% if message_details.ishighspam %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">SA Spam:</td>
		<td class="maildetail">{% if message_details.issaspam %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">Listed in RBL:</td>
		<td class="maildetail">{% if message_details.isrblspam %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">Spam Whitelisted:</td>
		<td class="maildetail">{% if message_details.spamwhitelisted %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">Spam Blacklisted:</td>
		<td class="maildetail">{% if message_details.spamblacklisted %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">SA Autolearned:</td>
		<td class="maildetail">{{message_details.spamreport|tds_is_learned}}</td>
		</tr>
		<tr>
		<td class="mailitem">SA Score:</td>
		<td class="maildetail">{{ message_details.sascore }}</td>
		</tr>
		<tr>
		<td class="mailitem">Spam Report:</td>
		<td>{% spam_report message_details.spamreport %}</td>
		</tr>
		<tr>
		<td colspan="2" class="divider">Message Content Protection (MCP)</td>
		</tr>
		<tr>
		<td class="mailitem">MCP:</td>
		<td class="maildetail">{% if message_details.ismcp %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">High Scoring MCP:</td>
		<td class="maildetail">{% if message_details.ishighmcp %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">SA MCP:</td>
		<td class="maildetail">{% if message_details.issamcp %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">MCP Whitelisted:</td>
		<td class="maildetail">{% if message_details.mcpwhitelisted %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		<tr>
		<td class="mailitem">MCP Blacklisted:</td>
		<td class="maildetail">{% if message_details.mcpblacklisted %}<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}</td>
		</tr>
		{% if message_details.quarantined %}
		<tr>
		<td colspan="2" class="divider"><a name="q">Quarantine</a></td>
		</tr>
		<tr>
		<td colspan="2">&nbsp;</td>
		</tr>
		<tr>
		<td colspan="2">
		<!-- Nested quarantine table -->
    <div id="ajax_status"></div>
		<div id="server_response">
		</div>
		<div id="quarantine_errors">
		</div>
		<!--<form id="qform" action="/messages/process_quarantine/" method="post">-->
		<div id="process_quarantine">
		<table width="100%">
		<tbody>
		<tr>
		<td>Release</td>
		<td>Delete</td>
		<td>SA Learn</td>
		<td>Preview</td>
		<td>Dangerous</td>
		</tr>
		<tr>
		<td>
    {% if not message_details.virusinfected and not message_details.namedinfected and not message_details.otherinfected %}{{ form.release }}{%endif%}</td>
		<td>
    {% if not message_details.virusinfected and not message_details.namedinfected and not message_details.otherinfected %}{{ form.todelete }}{%endif%}</td>
		<td>
    {% if not message_details.virusinfected and not message_details.namedinfected and not message_details.otherinfected %}
		{{ form.salearn }}&nbsp;
		{{ form.salearn_as }}
    {% endif %}
		</td>
		<td>
    {% if not message_details.virusinfected and not message_details.otherinfected %}
    <a href="/messages/preview/{{message_details.id}}/">{{ message_details.id }}</a>
    {%endif %}
    </td>
		<td>
		{% if message_details.virusinfected or message_details.namedinfected or message_details.otherinfected %}
		<span class="positive">Y</span>{% else %}<span class="negative">N</span>{% endif %}
		</td>
		</tr>
		<tr>
		<td colspan="4">
		{{ form.use_alt }}&nbsp;Alternative recipients:&nbsp;
		<input type="text" id="id_altrecipients" name="altrecipients" size="70" />
		</td>
		<td>
		<input type="hidden" name="message_id" id="id_message_id" value="{{ message_details.id }}" />
		<input type="submit" id="submit_q_request" value="Submit" />
		</td>
		</tr>
    </tbody>
    </table>
    <!--</form>-->
    </div>
    <!-- End nested quarantine table -->
    </td>
    </tr>
{% endif %}
    <tr>
    <td colspan="2">&nbsp;</td>
    </tr>
{% else %}
    <tr>
    <td>The message details for the requested message id could not be retrieved</td>
    </tr>
{% endif %}
  </tbody>
</table>
{% endblock content %}
